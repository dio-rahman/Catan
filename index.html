<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="logo/logo_thithep.png">
    <link href="https://fonts.googleapis.com/css2?family=Coiny&display=swap" rel="stylesheet">
    <title>THITHEP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="flex flex-col items-center min-h-screen font-[Coiny]">
    <img src="logo/logo_thithep3.png" alt="Logo THITHEP" class="logo-thithep mx-auto">
    <div class="flex flex-row gap-4">
        <div class="relative">
            <canvas id="papan" width="700" height="700" class="shadow-lg" aria-label="Papan permainan"></canvas>
            <div id="poin-menang" class="text-base mt-4"></div>
            <div id="game-over-container" class="hidden">
                <div id="game-over-content" class="bg-[#cecece] p-6 rounded-lg shadow-lg">
                    <h2 class="text-2xl mb-4" style="color: #000000;">Terima Kasih Telah Bermain</h2>
                    <div id="ranking-text" class="text-lg mb-6"></div>
                    <div class="flex justify-center gap-4">
                        <button id="tombol-selesai" class="bg-black px-6 py-3 rounded text-lg hover:bg-green-700" disabled aria-label="Kembali ke halaman utama">Selesai</button>
                        <button id="tombol-main-lagi" class="bg-black px-6 py-3 rounded text-lg hover:bg-orange-700" disabled aria-label="Main lagi">Main Lagi</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="kontrol-container">
            <div id="kontrol" class="rounded-lg shadow-md p-6 bg-[#1a1a1a]">
                <div id="timer-bar-container" class="hidden">
                    <div id="timer-bar"></div>
                    <div id="dots-container"></div>
                    <div id="timer-text">60 detik</div>
                </div>
                <div id="waktu-habis" class="w-full hidden">WAKTU HABIS! Tekan tombol "Ganti Pemain" untuk melanjutkan.</div>
                <div id="info" class="text-xl mb-6">Pemain 1 : Lempar Dadu</div>
                <div id="player-controls-container" class="grid grid-cols-2 gap-4 mb-6">
                    <div class="player-controls bg-[#cc0000] p-4 rounded-lg" data-player="1">
                        <div class="text-lg text-white mb-2">Pemain 1</div>
                        <div class="flex justify-center gap-4">
                            <button class="lempar-dadu bg-black px-4 py-2 rounded text-lg hover:bg-yellow-500 disabled:tombol-dinonaktifkan" data-player="1" aria-label="Lempar dadu Pemain 1">Lempar Dadu</button>
                            <button class="ganti-pemain bg-black px-4 py-2 rounded text-lg hover:bg-red-800 disabled:tombol-dinonaktifkan" data-player="1" disabled aria-label="Ganti pemain Pemain 1">Ganti Pemain</button>
                        </div>
                    </div>
                    <div class="player-controls bg-[#33cc33] p-4 rounded-lg" data-player="2">
                        <div class="text-lg text-white mb-2">Pemain 2</div>
                        <div class="flex justify-center gap-4">
                            <button class="lempar-dadu bg-black px-4 py-2 rounded text-lg hover:bg-yellow-500 disabled:tombol-dinonaktifkan" data-player="2" aria-label="Lempar dadu Pemain 2">Lempar Dadu</button>
                            <button class="ganti-pemain bg-black px-4 py-2 rounded text-lg hover:bg-red-800 disabled:tombol-dinonaktifkan" data-player="2" disabled aria-label="Ganti pemain Pemain 2">Ganti Pemain</button>
                        </div>
                    </div>
                    <div class="player-controls bg-[#3399ff] p-4 rounded-lg" data-player="3">
                        <div class="text-lg text-white mb-2">Pemain 3</div>
                        <div class="flex justify-center gap-4">
                            <button class="lempar-dadu bg-black px-4 py-2 rounded text-lg hover:bg-yellow-500 disabled:tombol-dinonaktifkan" data-player="3" aria-label="Lempar dadu Pemain 3">Lempar Dadu</button>
                            <button class="ganti-pemain bg-black px-4 py-2 rounded text-lg hover:bg-red-800 disabled:tombol-dinonaktifkan" data-player="3" disabled aria-label="Ganti pemain Pemain 3">Ganti Pemain</button>
                        </div>
                    </div>
                    <div class="player-controls bg-[#FF00FF] p-4 rounded-lg" data-player="4">
                        <div class="text-lg text-white mb-2">Pemain 4</div>
                        <div class="flex justify-center gap-4">
                            <button class="lempar-dadu bg-black px-4 py-2 rounded text-lg hover:bg-yellow-500 disabled:tombol-dinonaktifkan" data-player="4" aria-label="Lempar dadu Pemain 4">Lempar Dadu</button>
                            <button class="ganti-pemain bg-black px-4 py-2 rounded text-lg hover:bg-red-800 disabled:tombol-dinonaktifkan" data-player="4" disabled aria-label="Ganti pemain Pemain 4">Ganti Pemain</button>
                        </div>
                    </div>
                </div>
                <div id="hasil-dadu" class="text-xl mt-6"></div>
                <div id="kontainer-pertanyaan" class="mt-6 hidden">
                    <div id="teks-pertanyaan" class="text-xl"></div>
                    <input type="text" id="input-jawaban" class="border p-3 rounded mt-3 w-full text-lg font-[Coiny]" placeholder="Jawaban" aria-label="Masukkan jawaban">
                    <button id="kirim-jawaban" class="bg-green-600 px-6 py-3 rounded text-lg hover:bg-green-700 mt-3 disabled:tombol-dinonaktifkan" aria-label="Kirim jawaban">Kirim Jawaban</button>
                </div>
                <div id="audio-error" class="w-full hidden">Gagal memuat beberapa file audio. Permainan akan berlanjut tanpa efek suara tertentu.</div>
                <div id="asset-error" class="w-full hidden">Gagal memuat beberapa aset. Periksa konsol untuk detail.</div>
            </div>
        </div>
    </div>

    <!-- Audio Elements -->
    <audio id="audio-jawaban" src="bpm/jawaban-backsound.mp3" preload="auto" loop></audio>
    <audio id="audio-kocokan-dadu" src="bpm/kocokan-dadu.mp3" preload="auto"></audio>
    <audio id="audio-button-click" src="bpm/button-click.mp3" preload="auto"></audio>
    <audio id="audio-select-area" src="bpm/select-area.mp3" preload="auto"></audio>
    <audio id="audio-time-up" src="bpm/time-up.mp3" preload="auto"></audio>
    <audio id="audio-confirm" src="bpm/confirm.mp3" preload="auto"></audio>

    <!-- Modal Konfirmasi -->
    <div id="modal-konfirmasi" class="hidden">
        <div id="modal-konten" class="bg-[#cecece] p-6 rounded-lg shadow-lg">
            <p id="modal-pesan" class="text-lg mb-6"></p>
            <div class="flex justify-center gap-4">
                <button id="tombol-iya" class="bg-white px-4 py-2 rounded text-lg hover:bg-green-600" aria-label="Konfirmasi">Iya</button>
                <button id="tombol-tidak" class="bg-white px-4 py-2 rounded text-lg hover:bg-red-600" aria-label="Batal">Tidak</button>
            </div>
        </div>
    </div>

    <script>
        const kanvas = document.getElementById('papan');
        const konteks = kanvas.getContext('2d');
        const jariJariHeksagon = 75;
        const ukuranTeks = jariJariHeksagon * 0.5;
        const ukuranTanda = jariJariHeksagon * 0.8;

        const tataLetakPapan = [
            { q: -2, r: 0 }, { q: -2, r: 1 }, { q: -2, r: 2 },
            { q: -1, r: -1 }, { q: -1, r: 0 }, { q: -1, r: 1 }, { q: -1, r: 2 },
            { q: 0, r: -2 }, { q: 0, r: -1 }, { q: 0, r: 0 }, { q: 0, r: 2 }, { q: 0, r: 1 },
            { q: 1, r: -2 }, { q: 1, r: -1 }, { q: 1, r: 0 }, { q: 1, r: 1 },
            { q: 2, r: -2 }, { q: 2, r: -1 }, { q: 2, r: 0 }
        ];

        const nomorAreaTetap = [
            1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18
        ];

        const petaWarna = {
            1: '#03bf68', 2: '#5ee2e7', 3: '#fc65c2',
            4: '#c2ff74', 5: '#a5a5a5', 6: '#fe914e'
        };

        const petaNamaArea = {
            1: 'hijau',
            2: 'biru',
            3: 'pink',
            4: 'kuning',
            5: 'abu',
            6: 'oranye'
        };

        const petaGambar = {};
        let assetError = false;
        let failedAssets = [];

        const pemain = [
            { id: 1, warna: '#cc0000', poinKemenangan: 0, waktuMencapaiSkor: null },
            { id: 2, warna: '#33CC33', poinKemenangan: 0, waktuMencapaiSkor: null },
            { id: 3, warna: '#3399FF', poinKemenangan: 0, waktuMencapaiSkor: null },
            { id: 4, warna: '#FF00FF', poinKemenangan: 0, waktuMencapaiSkor: null }
        ];

        const pertanyaan = [
            { id: 1, teks: "Mengapa manusia tidak bisa hidup tanpa alam, tetapi alam bisa hidup tanpa manusia? Apa makna dari pernyataan ini menurutmu?", kataKunci: [";", "membutuhkan", "bergantung", "butuh", "tergantung", "kebutuhan", "alam", "lingkungan", "sumber daya", "hidup", "ketergantungan", "perlukan", "diperlukan", "sumber kehidupan", "ekosistem", "manusia"], area: 1 },
            { id: 2, teks: "Bagaimana dampak penebangan pohon secara liar terhadap lingkungan?", kataKunci: [";", "kerusakan", "hutan", "membutuhkan", "rusak", "merusak", "dirusak", "kehutanan", "butuh", "deforestasi", "lingkungan", "erosi", "banjir", "tanah longsor", "ekosistem", "pencemaran", "kehancuran", "degradasi", "kehilangan habitat", "flora", "fauna", "pohon", "tebang", "illegal logging", "penggundulan"], area: 1 },
            { id: 3, teks: "Apa dampak dari polusi udara terhadap kesehatan manusia dan bagaimana cara mengatasinya?", kataKunci: [";", "gangguan pernapasan", "asma", "mengobati", "menghindari", "pernafasan", "penyakit paru", "obati", "hindari", "polusi", "udara", "kesehatan", "infeksi saluran pernapasan", "masker", "pencemaran", "sesak napas", "bronkitis", "kanker paru", "filter udara", "kurangi emisi", "kualitas udara", "polutan", "kabut asap", "respirasi"], area: 1 },
            { id: 4, teks: "Bagaimana perubahan alam akibat ulah manusia bisa memengaruhi bencana alam seperti banjir atau tanah longsor? Jelaskan hubungan keduanya.", kataKunci: [";", "sampah", "pencemaran", "kerusakan", "limbah", "polusi", "rusak", "merusak", "banjir", "tanah longsor", "deforestasi", "erosi", "lingkungan", "alam", "penggundulan hutan", "penumpukan sampah", "saluran tersumbat", "degradasi tanah", "bencana", "aktivitas manusia", "pengrusakan", "limpasan air"], area: 2 },
            { id: 5, teks: "Apakah semua bentuk interaksi manusia dengan alam itu merugikan? Jelaskan dan beri contoh interaksi yang menguntungkan alam.", kataKunci: [";", "tidak", "bukan", "enggak", "menguntungkan", "manfaat", "konservasi", "penanaman pohon", "restorasi", "reboisasi", "pelestarian", "perlindungan", "ekosistem", "keberlanjutan", "ramah lingkungan", "interaksi positif", "penghijauan"], area: 2 },
            { id: 6, teks: "Apa dampak dari pembuangan sampah sembarangan terhadap lingkungan sekitar dan bagaimana cara mengatasi masalah tersebut?", kataKunci: [";", "pencemaran", "kesadaran", "masyarakat", "polusi", "sadar", "komunitas", "sampah", "limbah", "lingkungan", "pengelolaan sampah", "daur ulang", "pembuangan liar", "kontaminasi", "kebersihan", "edukasi lingkungan", "tempat sampah", "pengurangan sampah", "sanitasi"], area: 2 },
            { id: 7, teks: "Mengapa penting menjaga keanekaragaman hayati di lingkungan sekitar kita?", kataKunci: [";", "melindungi", "ekosistem", "lindungi", "pelestarian", "sistem ekologi", "keanekaragaman hayati", "biodiversitas", "flora", "fauna", "keseimbangan alam", "konservasi", "spesies", "habitat", "kelestarian", "keberlanjutan", "rantai makanan", "ekologi"], area: 3 },
            { id: 8, teks: "Mengapa banjir sering terjadi di daerah dengan sistem drainase yang buruk?", kataKunci: [";", "penumpukan air", "tersumbatnya saluran", "sampah", "genangan", "sumbatan", "limbah", "banjir", "drainase", "saluran air", "pemeliharaan", "sistem pembuangan", "penyumbatan", "hujan deras", "infrastruktur", "limpasan", "pengelolaan air"], area: 3 },
            { id: 9, teks: "Mengapa daur ulang penting untuk mengurangi pencemaran lingkungan?", kataKunci: [";", "mencegah", "sampah", "cegah", "limbah", "daur ulang", "recycle", "pencemaran", "lingkungan", "pengelolaan sampah", "pengurangan limbah", "keberlanjutan", "material bekas", "polusi", "ramah lingkungan"], area: 3 },
            { id: 10, teks: "Kenapa polusi udara sangat berpengaruh pada kesehatan manusia dan bagaimana cara menanggulanginya?", kataKunci: [";", "mengurangi", "penggunaan", "pernafasan", "kurangi", "utilisasi", "pernapasan", "polusi", "udara", "kesehatan", "emisi", "polutan", "kualitas udara", "asap", "kabut asap", "masker", "filter udara", "kendaraan", "industri", "penyakit paru"], area: 4 },
            { id: 11, teks: "Apakah kesadaran masyarakat dalam mengurangi pencemaran lingkungan sangatlah penting? Jelaskan!", kataKunci: [";", "iya", "penting", "ya", "krusial", "sangat perlu", "kesadaran", "masyarakat", "pencemaran", "lingkungan", "edukasi", "sadar lingkungan", "partisipasi", "tanggung jawab", "kebersihan", "pelestarian"], area: 4 },
            { id: 12, teks: "Apakah menjaga keanekaragaman makhluk hidup sangat penting bagi keseimbangan alam? Jelaskan!", kataKunci: [";", "iya", "ya", "keanekaragaman", "biodiversitas", "keseimbangan", "alam", "ekosistem", "pelestarian", "konservasi", "spesies", "habitat", "keberlanjutan", "rantai makanan"], area: 4 },
            { id: 13, teks: "Apa solusi untuk mengatasi tersumbatnya saluran air di perkotaan?", kataKunci: [";", "pembersihan", "perawatan", "bersihkan", "maintenance", "saluran air", "drainase", "sampah", "penyumbatan", "pengelolaan limbah", "sistem drainase", "pemeliharaan", "penumpukan", "infrastruktur", "kebersihan"], area: 5 },
            { id: 14, teks: "Apa saja kebutuhan manusia yang bergantung pada alam setiap harinya?", kataKunci: [";", "membutuhkan", "butuh", "bergantung", "alam", "sumber daya", "air", "udara", "pangan", "energi", "kebutuhan hidup", "lingkungan", "ketergantungan", "sumber kehidupan", "tanaman", "hewan"], area: 5 },
            { id: 15, teks: "Apakah kegiatan penebangan hutan secara ilegal dapat memperburuk kerusakan lingkungan? Jelaskan!", kataKunci: [";", "iya", "ya", "penebangan", "hutan", "kerusakan", "lingkungan", "deforestasi", "illegal logging", "penggundulan", "erosi", "banjir", "tanah longsor", "degradasi", "ekosistem"], area: 5 },
            { id: 16, teks: "Apakah ada cara agar manusia dapat hidup selaras dengan alam? Berikan contohnya!", kataKunci: [";", "ada", "dengan cara", "bisa", "melalui", "selaras", "alam", "konservasi", "reboisasi", "keberlanjutan", "ramah lingkungan", "penghijauan", "pelestarian", "pengurangan limbah", "energi terbarukan", "harmoni"], area: 6 },
            { id: 17, teks: "Bagaimana dampak jangka panjang terhadap alam jika manusia terus bersikap tidak peduli terhadap lingkungan?", kataKunci: [";", "kerusakan", "rusak", "merusak", "lingkungan", "pencemaran", "degradasi", "bencana alam", "ekosistem", "kehancuran", "polusi", "kehilangan biodiversitas", "perubahan iklim", "krisis lingkungan", "ketidakseimbangan"], area: 6 },
            { id: 18, teks: "Apakah tindakan kecil seperti mengurangi penggunaan plastik dapat membantu menjaga lingkungan? Jelaskan!", kataKunci: [";", "iya", "membantu", "penting", "ya", "bantu", "krusial", "plastik", "lingkungan", "pengurangan", "sampah", "keberlanjutan", "ramah lingkungan", "limbah plastik", "daur ulang", "pelestarian", "edukasi lingkungan", "tindakan kecil"], area: 6 }
        ];

        let area = [];
        let pemainSekarang = 0;
        let hasilDaduSekarang = null;
        let menungguPemilihanArea = false;
        let pertanyaanTersedia = [];
        let pertanyaanSaatIni = null;
        let timerId = null;
        let updateTimerId = null;
        let sisaWaktu = 60;
        let blinkSoundInterval = null;
        let waktuMulaiPermainan = null;
        let lastInvalidClick = 0;
        let audioErrorShown = false;
        let gameOver = false;

        const audioElements = [
            'audio-jawaban', 'audio-kocokan-dadu', 'audio-button-click',
            'audio-select-area', 'audio-time-up', 'audio-confirm'
        ];
        let audioLoaded = {};

        function initAudio() {
            audioElements.forEach(id => {
                const audio = document.getElementById(id);
                audioLoaded[id] = false;
                audio.addEventListener('canplaythrough', () => {
                    audioLoaded[id] = true;
                    console.log(`Audio ${id} loaded successfully: ${audio.src}`);
                });
                audio.addEventListener('error', () => {
                    console.error(`Failed to load audio: ${audio.src}`);
                    failedAssets.push(audio.src);
                    if (!audioErrorShown) {
                        document.getElementById('audio-error').style.display = 'block';
                        audioErrorShown = true;
                    }
                });
                audio.load();
            });
        }

        function playAudio(audioId, retryCount = 0) {
            const audio = document.getElementById(audioId);
            if (!audio) {
                console.error(`Audio element ${audioId} not found`);
                return;
            }
            if (audioLoaded[audioId]) {
                audio.pause();
                audio.currentTime = 0;
                audio.play().catch(e => {
                    console.warn(`Failed to play audio ${audioId}: ${e.message}`);
                });
            } else if (retryCount < 2) {
                setTimeout(() => {
                    console.log(`Retrying audio ${audioId}, attempt ${retryCount + 1}`);
                    playAudio(audioId, retryCount + 1);
                }, 500);
            } else {
                console.warn(`Audio ${audioId} not loaded after retries: ${audio.src}`);
            }
        }

        function preloadAssets() {
            return new Promise((resolve) => {
                let loadedImages = 0;
                let loadedAudio = 0;
                const totalImages = 18;
                const totalAudio = audioElements.length;

                for (let i = 1; i <= 18; i++) {
                    petaGambar[i] = new Image();
                    petaGambar[i].src = `gambar-area/gambar-area-${i}.png`;
                    petaGambar[i].onload = () => {
                        console.log(`Gambar gambar-area-${i}.png berhasil dimuat`);
                        loadedImages++;
                        if (loadedImages + failedAssets.length === totalImages && loadedAudio === totalAudio) {
                            resolve();
                        }
                    };
                    petaGambar[i].onerror = () => {
                        console.error(`Gagal memuat gambar: gambar-area/gambar-area-${i}.png`);
                        failedAssets.push(`gambar-area/gambar-area-${i}.png`);
                        assetError = true;
                        if (loadedImages + failedAssets.length === totalImages && loadedAudio === totalAudio) {
                            resolve();
                        }
                    };
                }

                audioElements.forEach(id => {
                    const audio = document.getElementById(id);
                    audio.addEventListener('canplaythrough', () => {
                        loadedAudio++;
                        if (loadedImages + failedAssets.length === totalImages && loadedAudio === totalAudio) {
                            resolve();
                        }
                    }, { once: true });
                    audio.addEventListener('error', () => {
                        loadedAudio++;
                        if (loadedImages + failedAssets.length === totalImages && loadedAudio === totalAudio) {
                            resolve();
                        }
                    }, { once: true });
                });
            });
        }

        function kocok(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function heksagonKePiksel(q, r) {
            const x = jariJariHeksagon * (Math.sqrt(3) * q + Math.sqrt(3) / 2 * r) + kanvas.width / 2;
            const y = jariJariHeksagon * (3 / 2 * r) + kanvas.height / 2;
            return { x, y };
        }

        function pikselKeHeksagon(px, py) {
            const adjustedPx = px - kanvas.width / 2;
            const adjustedPy = py - kanvas.height / 2;
            const q = (Math.sqrt(3) / 3 * adjustedPx - adjustedPy / 3) / jariJariHeksagon;
            const r = (2 / 3 * adjustedPy) / jariJariHeksagon;
            return roundHeksagon(q, r);
        }

        function roundHeksagon(q, r) {
            const s = -q - r;
            let rq = Math.round(q);
            let rr = Math.round(r);
            let rs = Math.round(s);
            const qDiff = Math.abs(rq - q);
            const rDiff = Math.abs(rr - r);
            const sDiff = Math.abs(rs - s);
            if (qDiff > rDiff && qDiff > sDiff) {
                rq = -rr - rs;
            } else if (rDiff > sDiff) {
                rr = -rq - rs;
            }
            return { q: rq, r: rr };
        }

        function gambarTitikDadu(konteks, x, y, nilai, radiusTitik) {
            konteks.fillStyle = '#FFFFFF';
            const offset = jariJariHeksagon * 0.4;
            const posisiTitik = {
                1: [[0, 0]],
                2: [[-offset, -offset], [offset, offset]],
                3: [[-offset, -offset], [0, 0], [offset, offset]],
                4: [[-offset, -offset], [-offset, offset], [offset, -offset], [offset, offset]],
                5: [[-offset, -offset], [-offset, offset], [0, 0], [offset, -offset], [offset, offset]],
                6: [[-offset, -offset], [-offset, 0], [-offset, offset], [offset, -offset], [offset, 0], [offset, offset]]
            };
            const titik = posisiTitik[nilai] || [];
            titik.forEach(([dx, dy]) => {
                konteks.beginPath();
                konteks.arc(x + dx, y + dy, radiusTitik, 0, 2 * Math.PI);
                konteks.fill();
            });
        }

        function animasiKocokanDadu(x, y, nilaiAkhir, durasi, callback) {
            const mulaiWaktu = performance.now();
            const radiusTitik = 10;

            function gambarTitikAcak() {
                const waktuSekarang = performance.now();
                const sisaWaktu = mulaiWaktu + durasi - waktuSekarang;

                if (sisaWaktu <= 0) {
                    tampilkanPapan();
                    const audioKocokan = document.getElementById('audio-kocokan-dadu');
                    audioKocokan.pause();
                    audioKocokan.currentTime = 0;
                    callback();
                    return;
                }

                tampilkanPapan();

                konteks.beginPath();
                for (let i = 0; i < 6; i++) {
                    const sudut = Math.PI / 180 * (60 * i - 30);
                    const px = x + jariJariHeksagon * Math.cos(sudut);
                    const py = y + jariJariHeksagon * Math.sin(sudut);
                    if (i === 0) konteks.moveTo(px, py);
                    else konteks.lineTo(px, py);
                }
                konteks.closePath();
                konteks.fillStyle = 'black';
                konteks.fill();
                konteks.strokeStyle = 'white';
                konteks.lineWidth = 2;
                konteks.stroke();

                const jumlahTitik = Math.floor(Math.random() * 6) + 1;
                konteks.fillStyle = '#FFFFFF';
                for (let i = 0; i < jumlahTitik; i++) {
                    const dx = (Math.random() - 0.5) * jariJariHeksagon * 0.8;
                    const dy = (Math.random() - 0.5) * jariJariHeksagon * 0.8;
                    konteks.beginPath();
                    konteks.arc(x + dx, y + dy, radiusTitik, 0, 2 * Math.PI);
                    konteks.fill();
                }

                requestAnimationFrame(gambarTitikAcak);
            }

            requestAnimationFrame(gambarTitikAcak);
        }

        function buatHeksagon(x, y, warna, adalahPusat, itemArea) {
            konteks.beginPath();
            for (let i = 0; i < 6; i++) {
                const sudut = Math.PI / 180 * (60 * i - 30);
                const px = x + jariJariHeksagon * Math.cos(sudut);
                const py = y + jariJariHeksagon * Math.sin(sudut);
                if (i === 0) konteks.moveTo(px, py);
                else konteks.lineTo(px, py);
            }
            konteks.closePath();
            konteks.fillStyle = warna || '#ffffff';
            konteks.fill();
            konteks.strokeStyle = '#ffffff';
            konteks.lineWidth = 2;
            konteks.stroke();

            if (!adalahPusat && itemArea.nomor && petaGambar[itemArea.nomor]) {
                const gambar = petaGambar[itemArea.nomor];
                if (gambar.complete && gambar.naturalWidth !== 0) {
                    try {
                        const ukuranGambar = jariJariHeksagon * 1.5;
                        konteks.save();
                        konteks.beginPath();
                        for (let i = 0; i < 6; i++) {
                            const sudut = Math.PI / 180 * (60 * i - 30);
                            const px = x + jariJariHeksagon * 0.8 * Math.cos(sudut);
                            const py = y + jariJariHeksagon * 0.8 * Math.sin(sudut);
                            if (i === 0) konteks.moveTo(px, py);
                            else konteks.lineTo(px, py);
                        }
                        konteks.closePath();
                        konteks.clip();
                        konteks.globalAlpha = 1;
                        konteks.drawImage(
                            gambar,
                            x - ukuranGambar / 2,
                            y - ukuranGambar / 2,
                            ukuranGambar,
                            ukuranGambar
                        );
                        konteks.globalAlpha = 1.0;
                        konteks.restore();
                    } catch (e) {
                        console.error(`Error drawing image for nomor ${itemArea.nomor}:`, e);
                    }
                }
            }

            let nomorTampilan = '';
            if (!adalahPusat && itemArea.areaNomor) {
                nomorTampilan = itemArea.areaNomor.toString();
            }

            if (nomorTampilan && !adalahPusat) {
                konteks.fillStyle = '#FFFFFF';
                konteks.strokeStyle = '#000';
                konteks.lineWidth = 7;
                konteks.font = `${ukuranTeks * 1.2}px Coiny`;
                konteks.textAlign = 'center';
                konteks.textBaseline = 'middle';
                konteks.strokeText(nomorTampilan, x, y);
                konteks.fillText(nomorTampilan, x, y);
            }

            if (adalahPusat && hasilDaduSekarang) {
                gambarTitikDadu(konteks, x, y, hasilDaduSekarang, 10);
            }

            if (itemArea.pemilik !== null) {
                konteks.strokeStyle = pemain[itemArea.pemilik].warna;
                konteks.lineWidth = 15;
                konteks.beginPath();
                konteks.arc(x, y, ukuranTanda / 2, 0, 2 * Math.PI);
                konteks.stroke();
            }
        }

        function tampilkanPapan() {
            if (gameOver) return;
            konteks.clearRect(0, 0, kanvas.width, kanvas.height);
            if (!area || area.length === 0) {
                console.warn('Area array is empty or not initialized');
                return;
            }
            area.forEach(itemArea => {
                const { x, y } = heksagonKePiksel(itemArea.q, itemArea.r);
                const adalahPusat = itemArea.q === 0 && itemArea.r === 0;
                buatHeksagon(x, y, itemArea.warna, adalahPusat, itemArea);
            });
        }

        function updateTimer() {
            sisaWaktu -= 0.5;
            document.getElementById('timer-text').textContent = `${Math.ceil(sisaWaktu)} detik`;

            const dotsContainer = document.getElementById('dots-container');
            const dot = document.createElement('div');
            dot.classList.add('dot');
            const position = (59 - sisaWaktu) / 59 * 741;
            dot.style.left = `${position}px`;
            dotsContainer.appendChild(dot);

            if (sisaWaktu <= 30 && sisaWaktu > 10) {
                document.getElementById('timer-bar').style.backgroundColor = '#eab308';
                const dots = document.querySelectorAll('.dot');
                dots.forEach(dot => dot.style.backgroundColor = '#eab308');
            }
            if (sisaWaktu <= 10) {
                document.getElementById('timer-bar').style.backgroundColor = '#ef4444';
                const dots = document.querySelectorAll('.dot');
                dots.forEach(dot => dot.style.backgroundColor = '#ef4444');
            }

            if (sisaWaktu <= 0) {
                clearInterval(updateTimerId);
            }
        }

        function startTimer() {
            sisaWaktu = 60;
            const timerBar = document.getElementById('timer-bar');
            const timerBarContainer = document.getElementById('timer-bar-container');
            const timerText = document.getElementById('timer-text');
            const dotsContainer = document.getElementById('dots-container');

            document.getElementById('waktu-habis').style.display = 'none';
            timerBar.style.backgroundColor = '#22c55e';
            dotsContainer.innerHTML = '';
            timerBarContainer.classList.remove('hidden');
            timerBar.style.width = '0%';
            timerText.textContent = `${sisaWaktu} detik`;

            if (updateTimerId) clearInterval(updateTimerId);
            updateTimerId = setInterval(updateTimer, 500);

            setTimeout(() => {
                timerBar.classList.add('active');
            }, 10);

            playAudio('audio-jawaban');

            timerId = setTimeout(() => {
                resetTimer();
                document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Waktu habis! Tekan "Ganti Pemain" untuk melanjutkan.`;
                document.getElementById('kontainer-pertanyaan').style.display = 'none';
                document.getElementById('input-jawaban').value = '';
                document.getElementById('waktu-habis').style.display = 'block';
                pertanyaanSaatIni = null;

                playAudio('audio-time-up');

                blinkSoundInterval = setInterval(() => {
                    if (document.getElementById('waktu-habis').style.display === 'block') {
                        playAudio('audio-time-up');
                    } else {
                        clearInterval(blinkSoundInterval);
                        blinkSoundInterval = null;
                    }
                }, 1000);

                enableGantiPemainForCurrentPlayer();
            }, 60000);
        }

        function resetTimer() {
            if (timerId) {
                clearTimeout(timerId);
                timerId = null;
            }
            if (updateTimerId) {
                clearInterval(updateTimerId);
                updateTimerId = null;
            }
            if (blinkSoundInterval) {
                clearInterval(blinkSoundInterval);
                blinkSoundInterval = null;
            }
            const timerBar = document.getElementById('timer-bar');
            const timerBarContainer = document.getElementById('timer-bar-container');
            const dotsContainer = document.getElementById('dots-container');
            timerBar.classList.remove('active');
            timerBar.style.width = '0%';
            dotsContainer.innerHTML = '';
            timerBarContainer.classList.add('hidden');
            document.getElementById('waktu-habis').style.display = 'none';

            const audioJawaban = document.getElementById('audio-jawaban');
            audioJawaban.pause();
            audioJawaban.currentTime = 0;
        }

        function setPlayerButtonsState(playerIndex, lemparDaduEnabled, gantiPemainEnabled) {
            const playerId = playerIndex + 1;
            const lemparDaduBtn = document.querySelector(`.lempar-dadu[data-player="${playerId}"]`);
            const gantiPemainBtn = document.querySelector(`.ganti-pemain[data-player="${playerId}"]`);
            if (lemparDaduBtn) {
                lemparDaduBtn.disabled = !lemparDaduEnabled;
                if (lemparDaduEnabled) {
                    lemparDaduBtn.classList.remove('tombol-dinonaktifkan');
                } else {
                    lemparDaduBtn.classList.add('tombol-dinonaktifkan');
                }
            }
            if (gantiPemainBtn) {
                gantiPemainBtn.disabled = !gantiPemainEnabled;
                if (gantiPemainEnabled) {
                    gantiPemainBtn.classList.remove('tombol-dinonaktifkan');
                } else {
                    gantiPemainBtn.classList.add('tombol-dinonaktifkan');
                }
            }
        }

        function enableLemparDaduForCurrentPlayer() {
            pemain.forEach((_, index) => {
                if (index === pemainSekarang) {
                    setPlayerButtonsState(index, true, false);
                } else {
                    setPlayerButtonsState(index, false, false);
                }
            });
        }

        function enableGantiPemainForCurrentPlayer() {
            pemain.forEach((_, index) => {
                if (index === pemainSekarang) {
                    setPlayerButtonsState(index, false, true);
                } else {
                    setPlayerButtonsState(index, false, false);
                }
            });
        }

        function disableAllPlayerButtons() {
            document.querySelectorAll('.lempar-dadu, .ganti-pemain').forEach(button => {
                button.disabled = true;
                button.classList.add('tombol-dinonaktifkan');
            });
        }

        function nonaktifkanSemuaTombolKontrol() {
            disableAllPlayerButtons();
            const tombolKirimJawaban = document.getElementById('kirim-jawaban');
            tombolKirimJawaban.disabled = true;
            tombolKirimJawaban.classList.add('tombol-dinonaktifkan');
        }

        function lemparDadu(otomatis = false) {
            if (!otomatis) playAudio('audio-button-click');

            if (pertanyaanTersedia.length === 0) {
                cekSelesaiPermainan();
                return;
            }

            const areasTersedia = [...new Set(pertanyaanTersedia.map(q => q.area))];
            if (areasTersedia.length === 0) {
                cekSelesaiPermainan();
                return;
            }

            const dadu = areasTersedia[Math.floor(Math.random() * areasTersedia.length)];
            hasilDaduSekarang = null;
            const elemenHasilDadu = document.getElementById('hasil-dadu');
            elemenHasilDadu.classList.add('kedip');
            elemenHasilDadu.textContent = `Dadu: Kocok...`;

            const { x, y } = heksagonKePiksel(0, 0);

            playAudio('audio-kocokan-dadu');

            animasiKocokanDadu(x, y, dadu, 2000, () => {
                hasilDaduSekarang = dadu;
                console.log(`Hasil dadu sekarang: ${hasilDaduSekarang} (${petaNamaArea[hasilDaduSekarang]})`);
                elemenHasilDadu.textContent = `warna area: ${petaNamaArea[dadu]}`;
                setTimeout(() => elemenHasilDadu.classList.remove('kedip'), 2000);

                const pertanyaanArea = pertanyaanTersedia.filter(q => q.area === dadu);
                if (pertanyaanArea.length === 0) {
                    document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Tidak ada pertanyaan tersedia untuk area ${petaNamaArea[dadu]}. Mengocok ulang...`;
                    if (areasTersedia.length > 0) {
                        setTimeout(() => lemparDadu(true), 1000);
                    } else {
                        cekSelesaiPermainan();
                    }
                    return;
                }
                const indeksPertanyaan = Math.floor(Math.random() * pertanyaanArea.length);
                pertanyaanSaatIni = pertanyaanArea[indeksPertanyaan];

                document.getElementById('kontainer-pertanyaan').style.display = 'block';
                document.getElementById('teks-pertanyaan').textContent = pertanyaanSaatIni.teks;
                document.getElementById('input-jawaban').style.display = 'block';
                document.getElementById('kirim-jawaban').style.display = 'block';

                disableAllPlayerButtons();
                const tombolKirimJawaban = document.getElementById('kirim-jawaban');
                tombolKirimJawaban.disabled = false;
                tombolKirimJawaban.classList.remove('tombol-dinonaktifkan');

                startTimer();
                tampilkanPapan();
            });
        }

        function kirimJawaban() {
            playAudio('audio-button-click');

            const jawaban = document.getElementById('input-jawaban').value.trim().toLowerCase();
            const kataKunci = pertanyaanSaatIni.kataKunci;

            resetTimer();

            const benar = kataKunci.some(kunci => jawaban.includes(kunci.toLowerCase()));

            const tombolKirimJawaban = document.getElementById('kirim-jawaban');
            tombolKirimJawaban.disabled = true;
            tombolKirimJawaban.classList.add('tombol-dinonaktifkan');

            if (benar) {
                document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Jawaban Benar!`;
                const indeks = pertanyaanTersedia.findIndex(q => q.id === pertanyaanSaatIni.id);
                pertanyaanTersedia.splice(indeks, 1);

                document.getElementById('input-jawaban').style.display = 'none';
                document.getElementById('kirim-jawaban').style.display = 'none';

                setTimeout(() => {
                    let areaBelumDiambil = area.filter(t => t.areaNomor === hasilDaduSekarang && t.pemilik === null && !(t.q === 0 && t.r === 0));
                    if (areaBelumDiambil.length > 0) {
                        menungguPemilihanArea = true;
                        document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Pilih area ${petaNamaArea[hasilDaduSekarang]} yang sesuai`;
                        tampilkanPapan();
                        disableAllPlayerButtons();
                    } else {
                        document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Tidak ada area untuk diambil. Tekan "Ganti Pemain"`;
                        document.getElementById('kontainer-pertanyaan').style.display = 'none';
                        enableGantiPemainForCurrentPlayer();
                    }
                }, 500);
            } else {
                document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Jawaban Salah. Tekan "Ganti Pemain"`;
                setTimeout(() => {
                    document.getElementById('kontainer-pertanyaan').style.display = 'none';
                    enableGantiPemainForCurrentPlayer();
                }, 500);
            }

            document.getElementById('input-jawaban').value = '';
            pertanyaanSaatIni = null;
        }

        function perbaruiPoinKemenangan() {
            pemain.forEach(itemPemain => {
                const poinLama = itemPemain.poinKemenangan;
                itemPemain.poinKemenangan = area.filter(t => t.pemilik === pemain.indexOf(itemPemain)).length;
                if (itemPemain.poinKemenangan > poinLama && itemPemain.waktuMencapaiSkor === null) {
                    itemPemain.waktuMencapaiSkor = Date.now() - waktuMulaiPermainan;
                }
            });
            let teksPoin = '';
            pemain.forEach(itemPemain => {
                teksPoin += `<div class="flex items-center mb-1"><span class="w-4 h-4 mr-2 inline-block" style="background-color: ${itemPemain.warna};"></span>Pemain ${itemPemain.id}: ${itemPemain.poinKemenangan} Poin</div>`;
            });
            document.getElementById('poin-menang').innerHTML = teksPoin;

            const areaTersedia = area.filter(t => t.pemilik === null && !(t.q === 0 && t.r === 0));
            if (areaTersedia.length === 0) {
                cekSelesaiPermainan();
            }
        }

        function cekSelesaiPermainan() {
            const areaTersedia = area.filter(t => t.pemilik === null && !(t.q === 0 && t.r === 0));
            if (areaTersedia.length === 0 || pertanyaanTersedia.length === 0) {
                gameOver = true;
                nonaktifkanSemuaTombolKontrol();
                const ranking = pemain.slice().sort((a, b) => {
                    if (b.poinKemenangan !== a.poinKemenangan) {
                        return b.poinKemenangan - a.poinKemenangan;
                    }
                    return (a.waktuMencapaiSkor || Infinity) - (b.waktuMencapaiSkor || Infinity);
                });
                let rankingText = '';
                ranking.forEach((p, index) => {
                    rankingText += `Juara ${index + 1}: Pemain ${p.id} dengan ${p.poinKemenangan} Poin<br>`;
                });
                document.getElementById('ranking-text').innerHTML = rankingText;
                document.getElementById('game-over-container').style.display = 'flex';
                document.getElementById('info').textContent = 'Permainan Selesai!';
                document.getElementById('tombol-selesai').disabled = false;
                document.getElementById('tombol-main-lagi').disabled = false;
                konteks.clearRect(0, 0, kanvas.width, kanvas.height);
            }
        }

        function giliranBerikutnya() {
            playAudio('audio-button-click');

            resetTimer();
            pemainSekarang = (pemainSekarang + 1) % pemain.length;
            hasilDaduSekarang = null;
            menungguPemilihanArea = false;
            document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Lempar dadu`;
            document.getElementById('kontainer-pertanyaan').style.display = 'none';
            document.getElementById('input-jawaban').value = '';
            document.getElementById('hasil-dadu').textContent = '';
            document.getElementById('input-jawaban').style.display = 'block';
            document.getElementById('kirim-jawaban').style.display = 'block';
            tampilkanPapan();

            enableLemparDaduForCurrentPlayer();
        }

        function tampilkanModalKonfirmasi(pesan, callback) {
            const modal = document.getElementById('modal-konfirmasi');
            const pesanElement = document.getElementById('modal-pesan');
            const tombolIya = document.getElementById('tombol-iya');
            const tombolTidak = document.getElementById('tombol-tidak');

            pesanElement.textContent = pesan;
            modal.style.display = 'flex';

            const tombolIyaClone = tombolIya.cloneNode(true);
            const tombolTidakClone = tombolTidak.cloneNode(true);
            tombolIya.parentNode.replaceChild(tombolIyaClone, tombolIya);
            tombolTidak.parentNode.replaceChild(tombolTidakClone, tombolTidak);

            tombolIyaClone.addEventListener('click', () => {
                playAudio('audio-confirm');
                modal.style.display = 'none';
                document.getElementById('kontainer-pertanyaan').style.display = 'none';
                callback(true);
            });

            tombolTidakClone.addEventListener('click', () => {
                playAudio('audio-button-click');
                modal.style.display = 'none';
                document.getElementById('input-jawaban').style.display = 'none';
                document.getElementById('kirim-jawaban').style.display = 'none';
                callback(false);
            });
        }

        kanvas.addEventListener('click', (event) => {
            if (!menungguPemilihanArea || gameOver) return;
            const now = Date.now();
            if (now - lastInvalidClick < 1000) return;
            lastInvalidClick = now;

            const rect = kanvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            const { q, r } = pikselKeHeksagon(x, y);
            const areaTerpilih = area.find(a => a.q === q && a.r === r);
            console.log(`Klik pada koordinat (${x}, ${y}), koordinat heksagon (${q}, ${r}), area terpilih:`, areaTerpilih ? { q: areaTerpilih.q, r: areaTerpilih.r, nomor: areaTerpilih.nomor, areaNomor: areaTerpilih.areaNomor, pemilik: areaTerpilih.pemilik } : 'Tidak ada area terdeteksi');
            if (areaTerpilih && areaTerpilih.areaNomor === hasilDaduSekarang && areaTerpilih.pemilik === null && !(areaTerpilih.q === 0 && areaTerpilih.r === 0)) {
                console.log(`Area valid dipilih: nomor ${areaTerpilih.nomor}, areaNomor ${areaTerpilih.areaNomor}, cocok dengan dadu ${hasilDaduSekarang}`);
                playAudio('audio-select-area');

                tampilkanModalKonfirmasi(
                    `Apakah Anda yakin ingin mengambil area dengan nomor ${areaTerpilih.nomor} di area ${petaNamaArea[areaTerpilih.areaNomor]}?`,
                    (konfirmasi) => {
                        if (konfirmasi) {
                            areaTerpilih.pemilik = pemainSekarang;
                            tampilkanPapan();
                            perbaruiPoinKemenangan();
                            menungguPemilihanArea = false;
                            document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Area berhasil diambil. Tekan "Ganti Pemain"`;
                            enableGantiPemainForCurrentPlayer();
                        } else {
                            document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Pilih area ${petaNamaArea[hasilDaduSekarang]} yang sesuai`;
                        }
                    }
                );
            } else {
                console.log(`Area tidak valid. Hasil dadu: ${hasilDaduSekarang}, area terpilih:`, areaTerpilih ? { areaNomor: areaTerpilih.areaNomor, pemilik: areaTerpilih.pemilik } : 'null');
                document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Area tidak valid. Pilih area ${petaNamaArea[hasilDaduSekarang]} yang belum diambil.`;
                console.warn('Area Tidak Valid.');
            }
        });

        document.querySelectorAll('.lempar-dadu').forEach(button => {
            button.addEventListener('click', () => {
                const playerId = parseInt(button.getAttribute('data-player'));
                if (playerId - 1 === pemainSekarang) {
                    lemparDadu(false);
                } else {
                    console.warn('Bukan giliran Anda!');
                }
            });
        });

        document.querySelectorAll('.ganti-pemain').forEach(button => {
            button.addEventListener('click', () => {
                const playerId = parseInt(button.getAttribute('data-player'));
                if (playerId - 1 === pemainSekarang) {
                    giliranBerikutnya();
                } else {
                    console.warn('Bukan giliran Anda!');
                }
            });
        });

        document.getElementById('kirim-jawaban').addEventListener('click', kirimJawaban);

        document.getElementById('input-jawaban').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                kirimJawaban();
            }
        });

        document.getElementById('tombol-selesai').addEventListener('click', () => {
            playAudio('audio-button-click');
            area = [];
            pertanyaanTersedia = [];
            pemainSekarang = 0;
            hasilDaduSekarang = null;
            menungguPemilihanArea = false;
            gameOver = false;
            document.getElementById('poin-menang').innerHTML = '';
            document.getElementById('hasil-dadu').textContent = '';
            document.getElementById('tombol-selesai').disabled = true;
            document.getElementById('tombol-main-lagi').disabled = true;
            resetTimer();
            window.location.href = 'home.html';
        });

        document.getElementById('tombol-main-lagi').addEventListener('click', () => {
            playAudio('audio-button-click');
            area = [];
            pemain.forEach(p => {
                p.poinKemenangan = 0;
                p.waktuMencapaiSkor = null;
            });
            pemainSekarang = 0;
            hasilDaduSekarang = null;
            menungguPemilihanArea = false;
            pertanyaanTersedia = [...pertanyaan];
            pertanyaanSaatIni = null;
            resetTimer();
            document.getElementById('game-over-container').style.display = 'none';
            gameOver = false;
            inisialisasiPapan();
            tampilkanPapan();
            perbaruiPoinKemenangan();
            enableLemparDaduForCurrentPlayer();
            waktuMulaiPermainan = Date.now();
            audioErrorShown = false;
            document.getElementById('audio-error').style.display = 'none';
            document.getElementById('asset-error').style.display = 'none';
        });

        function inisialisasiPapan() {
            area = [];
            const shuffledNomorArea = [...nomorAreaTetap];
            kocok(shuffledNomorArea);
            let nomorIndex = 0;

            tataLetakPapan.forEach((heks) => {
                if (heks.q === 0 && heks.r === 0) {
                    area.push({
                        q: heks.q,
                        r: heks.r,
                        nomor: null,
                        areaNomor: null,
                        warna: 'black',
                        pemilik: null
                    });
                } else {
                    const nomorArea = shuffledNomorArea[nomorIndex];
                    const pertanyaanArea = pertanyaan.find(p => p.id === nomorArea)?.area;
                    const warnaArea = petaWarna[pertanyaanArea] || '#ffffff';
                    area.push({
                        q: heks.q,
                        r: heks.r,
                        nomor: nomorArea,
                        areaNomor: pertanyaanArea,
                        warna: warnaArea,
                        pemilik: null
                    });
                    nomorIndex++;
                }
            });

            console.log('Areas initialized:', area.map(a => ({ q: a.q, r: a.r, nomor: a.nomor, areaNomor: a.areaNomor, warna: a.warna })));

            pertanyaanTersedia = [...pertanyaan];
            document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Lempar dadu`;
            waktuMulaiPermainan = Date.now();
            document.getElementById('tombol-selesai').disabled = true;
            document.getElementById('tombol-main-lagi').disabled = true;
            gameOver = false;
            enableLemparDaduForCurrentPlayer();
            document.getElementById('kirim-jawaban').disabled = true;
            document.getElementById('kirim-jawaban').classList.add('tombol-dinonaktifkan');
        }

        async function initializeGame() {
            try {
                initAudio();
                await preloadAssets();
                if (assetError || failedAssets.length > 0) {
                    console.warn(`Some assets failed to load: ${failedAssets.join(', ')}`);
                    document.getElementById('asset-error').style.display = 'block';
                }
                inisialisasiPapan();
                tampilkanPapan();
                perbaruiPoinKemenangan();
                setTimeout(tampilkanPapan, 100);
            } catch (e) {
                console.error('Error during game initialization:', e);
                document.getElementById('asset-error').style.display = 'block';
            }
        }

        initializeGame();
    </script>
</body>
</html>