<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="logo_thithep.png">
    <title>THITHEP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        canvas {
            background-color: #e6f3fa;
            border: 4px solid #2d3748;
            border-radius: 20px;
        }
        .kedip {
            animation: kedip 0.5s step-end infinite;
        }
        @keyframes kedip {
            50% { opacity: 0; }
        }
        .tombol-dinonaktifkan {
            background-color: #d1d5db !important;
            cursor: not-allowed !important;
        }
        #kontainer-pertanyaan {
            display: none;
        }
        #teks-pertanyaan {
            max-height: 150px;
            overflow-y: auto;
        }
        #timer-bar-container {
            width: 900px;
            height: 20px;
            background-color: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 20px;
            margin-bottom: 20px;
            position: relative;
            border: 2px solid #166534;
        }
        #timer-bar {
            width: 0%;
            height: 100%;
            background-color: #22c55e;
            transition: width 60s linear;
        }
        #timer-bar.active {
            width: 100%;
        }
        #dots-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        .dot {
            position: absolute;
            width: 30px;
            height: 20px;
            background-color: #22c55e;
            border-radius: 10px;
            transform: translateY(-50%);
            top: 50%;
            transition: left 0.5s linear;
        }
        #timer-text {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            text-align: center;
            line-height: 20px;
            color: #166534;
            font-weight: bold;
            z-index: 1;
        }
        #waktu-habis {
            display: none;
            background-color: #ef4444;
            color: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
            margin-top: 10px;
            margin-bottom: 10px;
            animation: kedip 1s step-end infinite;
        }
    </style>
</head>

<body class="bg-gray-100 flex flex-col items-center min-h-screen font-sans">
    <h1 class="text-4xl font-bold text-gray-800 mt-6 mb-4">Thinking Of The Problem</h1>
    <canvas id="papan" width="900" height="700" class="shadow-lg"></canvas>
    <div id="timer-bar-container" class="hidden">
        <div id="timer-bar"></div>
        <div id="dots-container"></div>
        <div id="timer-text">Waktu: 60 detik</div>
    </div>
    <div id="waktu-habis" class="w-full max-w-4xl">WAKTU HABIS! Tekan tombol "Ganti Pemain" untuk melanjutkan.</div>
    <div id="kontrol" class="mt-8 w-full max-w-4xl bg-white p-8 rounded-lg shadow-md">
        <div id="info" class="text-xl text-gray-700 mb-6">Pemain 1 : Lempar Dadu</div>
        <div class="flex flex-wrap justify-center gap-6">
            <button id="lempar-dadu" class="bg-blue-600 text-white px-6 py-3 rounded text-lg hover:bg-blue-700 disabled:tombol-dinonaktifkan">Lempar Dadu</button>
            <button id="ganti-pemain" class="bg-red-600 text-white px-6 py-3 rounded text-lg hover:bg-red-700 disabled:tombol-dinonaktifkan" disabled>Ganti Pemain</button>
        </div>
        <div id="hasil-dadu" class="text-xl text-gray-700 mt-6"></div>
        <div id="kontainer-pertanyaan" class="mt-6">
            <div id="teks-pertanyaan" class="text-xl text-gray-700"></div>
            <input type="text" id="input-jawaban" class="border p-3 rounded mt-3 w-full text-lg" placeholder="Jawaban">
            <button id="kirim-jawaban" class="bg-green-600 text-white px-6 py-3 rounded text-lg hover:bg-green-700 mt-3 disabled:tombol-dinonaktifkan">Kirim Jawaban</button>
        </div>
        <div id="poin-menang" class="text-base text-gray-600 mt-4"></div>
    </div>

    <script>
        const kanvas = document.getElementById('papan');
        const konteks = kanvas.getContext('2d');
        const JARI_JARI_HEKSAGON = 75;
        const UKURAN_TEKS = JARI_JARI_HEKSAGON * 0.5;
        const UKURAN_TANDA = JARI_JARI_HEKSAGON * 0.8;

        const tataLetakPapan = [
            { q: -2, r: 0 }, { q: -2, r: 1 }, { q: -2, r: 2 },
            { q: -1, r: -1 }, { q: -1, r: 0 }, { q: -1, r: 1 }, { q: -1, r: 2 },
            { q: 0, r: -2 }, { q: 0, r: -1 }, { q: 0, r: 0 }, { q: 0, r: 1 }, { q: 0, r: 2 },
            { q: 1, r: -2 }, { q: 1, r: -1 }, { q: 1, r: 0 }, { q: 1, r: 1 },
            { q: 2, r: -2 }, { q: 2, r: -1 }, { q: 2, r: 0 }
        ];

        const nomor = [1, 2, 3, 4, 5, 6, 1, 2, 3, 4, 5, 6, 1, 2, 3, 4, 5, 6];

        const petaWarna = {
            1: '#03bf68',
            2: '#5ee2e7',
            3: '#fc65c2',
            4: '#c2ff74',
            5: '#a5a5a5',
            6: '#fe914e'
        };

        const pemain = [
            { id: 1, warna: '#FF3333', poinKemenangan: 0 },
            { id: 2, warna: '#33CC33', poinKemenangan: 0 },
            { id: 3, warna: '#FFFF33', poinKemenangan: 0 },
            { id: 4, warna: '#3399FF', poinKemenangan: 0 }
        ];

        const pertanyaan = [
            { id: 1, teks: "Mengapa manusia tidak bisa hidup tanpa alam, tetapi alam bisa hidup tanpa manusia? Apa makna dari pernyataan ini menurutmu?", kataKunci: ["membutuhkan"], area: 1 },
            { id: 2, teks: "Bagaimana dampak penebangan pohon secara liar terhadap lingkungan?", kataKunci: ["kerusakan", "hutan"], area: 1 },
            { id: 3, teks: "Apa dampak dari polusi udara terhadap kesehatan manusia dan bagaimana cara mengatasinya?", kataKunci: ["gangguan pernapasan", "asma", "mengobati", "menghindari"], area: 1 },
            { id: 4, teks: "Bagaimana perubahan alam akibat ulah manusia bisa memengaruhi bencana alam seperti banjir atau tanah longsor? Jelaskan hubungan keduanya.", kataKunci: ["sampah", "pencemaran", "kerusakan"], area: 2 },
            { id: 5, teks: "Apakah semua bentuk interaksi manusia dengan alam itu merugikan? Jelaskan dan beri contoh interaksi yang menguntungkan alam.", kataKunci: ["tidak"], area: 2 },
            { id: 6, teks: "Apa dampak dari pembuangan sampah sembarangan terhadap lingkungan sekitar dan bagaimana cara mengatasi masalah tersebut?", kataKunci: ["pencemaran", "kesadaran", "masyarakat"], area: 2 },
            { id: 7, teks: "Mengapa penting menjaga keanekaragaman hayati di lingkungan sekitar kita?", kataKunci: ["melindungi", "ekosistem"], area: 3 },
            { id: 8, teks: "Mengapa banjir sering terjadi di daerah dengan sistem drainase yang buruk?", kataKunci: ["penumpukan air", "tersumbatnya saluran", "sampah"], area: 3 },
            { id: 9, teks: "Mengapa daur ulang penting untuk mengurangi pencemaran lingkungan?", kataKunci: ["mencegah", "sampah"], area: 3 },
            { id: 10, teks: "Kenapa polusi udara sangat berpengaruh pada kesehatan manusia dan bagaimana cara menanggulanginya?", kataKunci: ["mengurangi", "penggunaan"], area: 4 },
            { id: 11, teks: "Apakah kesadaran masyarakat dalam mengurangi pencemaran lingkungan sangatlah penting? Jelaskan!", kataKunci: ["iya", "penting"], area: 4 },
            { id: 12, teks: "Apakah menjaga keanekaragaman makhluk hidup sangat penting bagi keseimbangan alam? Jelaskan!", kataKunci: ["iya"], area: 4 },
            { id: 13, teks: "Apa solusi untuk mengatasi tersumbatnya saluran air di perkotaan?", kataKunci: ["pembersihan", "perawatan"], area: 5 },
            { id: 14, teks: "Apa saja kebutuhan manusia yang bergantung pada alam setiap harinya?", kataKunci: ["membutuhkan"], area: 5 },
            { id: 15, teks: "Apakah kegiatan penebangan hutan secara ilegal dapat memperburuk kerusakan lingkungan? Jelaskan!", kataKunci: ["iya"], area: 5 },
            { id: 16, teks: "Apakah ada cara agar manusia dapat hidup selaras dengan alam? Berikan contohnya!", kataKunci: ["ada", "dengan cara"], area: 6 },
            { id: 17, teks: "Bagaimana dampak jangka panjang terhadap alam jika manusia terus bersikap tidak peduli terhadap lingkungan?", kataKunci: ["kerusakan"], area: 6 },
            { id: 18, teks: "Jika manusia dan alam saling bekerja sama dengan baik apakah akan terjadi hubungan yang menguntungkan? Jelaskan!", kataKunci: ["iya"], area: 6 }
        ];

        let area = [];
        let pemainSekarang = 0;
        let hasilDaduSekarang = null;
        let menungguPemilihanArea = false;
        let pertanyaanTersedia = [];
        let pertanyaanSaatIni = null;
        let timerId = null;
        let updateTimerId = null;
        let sisaWaktu = 60;

        function kocok(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function heksagonKePiksel(q, r) {
            const qRot = -r;
            const rRot = q + r;
            const x = JARI_JARI_HEKSAGON * Math.sqrt(3) * (qRot + rRot / 2) + kanvas.width / 2;
            const y = JARI_JARI_HEKSAGON * 3 / 2 * rRot + kanvas.height / 2;
            return { x, y };
        }

        function gambarTitikDadu(konteks, x, y, nilai, radiusTitik) {
            konteks.fillStyle = '#FFFFFF';
            const offset = JARI_JARI_HEKSAGON * 0.4;
            const posisiTitik = {
                1: [[0, 0]],
                2: [[-offset, -offset], [offset, offset]],
                3: [[-offset, -offset], [0, 0], [offset, offset]],
                4: [[-offset, -offset], [-offset, offset], [offset, -offset], [offset, offset]],
                5: [[-offset, -offset], [-offset, offset], [0, 0], [offset, -offset], [offset, offset]],
                6: [[-offset, -offset], [-offset, offset], [-offset, 0], [offset, -offset], [offset, offset], [offset, 0]]
            };

            const titik = posisiTitik[nilai] || [];
            titik.forEach(([dx, dy]) => {
                konteks.beginPath();
                konteks.arc(x + dx, y + dy, radiusTitik, 0, 2 * Math.PI);
                konteks.fill();
            });
        }

        function animasiKocokanDadu(x, y, nilaiAkhir, durasi, callback) {
            const mulaiWaktu = performance.now();
            const radiusTitik = 10;

            function gambarTitikAcak() {
                const waktuSekarang = performance.now();
                const sisaWaktu = mulaiWaktu + durasi - waktuSekarang;

                if (sisaWaktu <= 0) {
                    tampilkanPapan();
                    callback();
                    return;
                }

                tampilkanPapan();

                konteks.beginPath();
                for (let i = 0; i < 6; i++) {
                    const sudut = Math.PI / 180 * (60 * i - 30);
                    const px = x + JARI_JARI_HEKSAGON * Math.cos(sudut);
                    const py = y + JARI_JARI_HEKSAGON * Math.sin(sudut);
                    if (i === 0) konteks.moveTo(px, py);
                    else konteks.lineTo(px, py);
                }
                konteks.closePath();
                konteks.fillStyle = '#000000';
                konteks.fill();
                konteks.strokeStyle = '#2d3748';
                konteks.lineWidth = 2;
                konteks.stroke();

                const jumlahTitik = Math.floor(Math.random() * 6) + 1;
                konteks.fillStyle = '#FFFFFF';
                for (let i = 0; i < jumlahTitik; i++) {
                    const dx = (Math.random() - 0.5) * JARI_JARI_HEKSAGON * 0.8;
                    const dy = (Math.random() - 0.5) * JARI_JARI_HEKSAGON * 0.8;
                    konteks.beginPath();
                    konteks.arc(x + dx, y + dy, radiusTitik, 0, 2 * Math.PI);
                    konteks.fill();
                }

                requestAnimationFrame(gambarTitikAcak);
            }

            requestAnimationFrame(gambarTitikAcak);
        }

        function buatHeksagon(x, y, warna, teks, adalahPusat, itemArea) {
            konteks.beginPath();
            for (let i = 0; i < 6; i++) {
                const sudut = Math.PI / 180 * (60 * i - 30);
                const px = x + JARI_JARI_HEKSAGON * Math.cos(sudut);
                const py = y + JARI_JARI_HEKSAGON * Math.sin(sudut);
                if (i === 0) konteks.moveTo(px, py);
                else konteks.lineTo(px, py);
            }
            konteks.closePath();
            konteks.fillStyle = warna;
            konteks.fill();
            konteks.strokeStyle = '#2d3748';
            konteks.lineWidth = 2;
            konteks.stroke();

            if (teks && !adalahPusat) {
                konteks.fillStyle = '#FFF';
                konteks.font = `${UKURAN_TEKS}px Arial`;
                konteks.textAlign = 'center';
                konteks.textBaseline = 'middle';
                konteks.fillText(teks, x, y);
            }

            if (adalahPusat && hasilDaduSekarang) {
                gambarTitikDadu(konteks, x, y, hasilDaduSekarang, 10);
            }

            if (itemArea.pemilik !== null) {
                konteks.strokeStyle = pemain[itemArea.pemilik].warna;
                konteks.lineWidth = 10;

                switch (itemArea.pemilik) {
                    case 0:
                    konteks.beginPath();
                        konteks.arc(x, y, UKURAN_TANDA / 2, 0, 2 * Math.PI);
                        konteks.stroke();
                    case 1:
                    konteks.beginPath();
                        konteks.arc(x, y, UKURAN_TANDA / 2, 0, 2 * Math.PI);
                        konteks.stroke();
                    case 2:
                    konteks.beginPath();
                        konteks.arc(x, y, UKURAN_TANDA / 2, 0, 2 * Math.PI);
                        konteks.stroke();
                    case 3:
                    konteks.beginPath();
                        konteks.arc(x, y, UKURAN_TANDA / 2, 0, 2 * Math.PI);
                        konteks.stroke();
                }
            }
        }

        function tampilkanPapan() {
            konteks.clearRect(0, 0, kanvas.width, kanvas.height);
            area.forEach(itemArea => {
                const { x, y } = heksagonKePiksel(itemArea.q, itemArea.r);
                const adalahPusat = itemArea.q === 0 && itemArea.r === 0;
                buatHeksagon(x, y, itemArea.warna, itemArea.nomor, adalahPusat, itemArea);
            });
        }

        function cariAreaTerdekat(x, y) {
            let areaTerdekat = null;
            let jarakMinimum = Infinity;
            area.forEach(itemArea => {
                const { x: tx, y: ty } = heksagonKePiksel(itemArea.q, itemArea.r);
                const jarak = Math.hypot(tx - x, ty - y);
                if (jarak < jarakMinimum && jarak < JARI_JARI_HEKSAGON) {
                    jarakMinimum = jarak;
                    areaTerdekat = itemArea;
                }
            });
            return areaTerdekat;
        }

        function updateTimer() {
            sisaWaktu -= 0.5;
            document.getElementById('timer-text').textContent = `Waktu: ${Math.ceil(sisaWaktu)} detik`;
            
            const dotsContainer = document.getElementById('dots-container');
            const dot = document.createElement('div');
            dot.classList.add('dot');
            const position = (60 - sisaWaktu) * (900 / 62);
            dot.style.left = `${position}px`;
            dotsContainer.appendChild(dot);
            
            if (sisaWaktu <= 30 && sisaWaktu > 10) {
                document.getElementById('timer-bar').style.backgroundColor = '#eab308';
            }
            if (sisaWaktu <= 10) {
                document.getElementById('timer-bar').style.backgroundColor = '#ef4444';
            }
            
            if (sisaWaktu <= 0) {
                clearInterval(updateTimerId);
            }
        }

        function startTimer() {
            sisaWaktu = 60;
            const timerBar = document.getElementById('timer-bar');
            const timerBarContainer = document.getElementById('timer-bar-container');
            const timerText = document.getElementById('timer-text');
            const dotsContainer = document.getElementById('dots-container');
            
            document.getElementById('waktu-habis').style.display = 'none';
            timerBar.style.backgroundColor = '#22c55e';
            dotsContainer.innerHTML = '';
            timerBarContainer.classList.remove('hidden');
            timerBar.style.width = '0%';
            timerText.textContent = `Waktu: ${sisaWaktu} detik`;
            
            if (updateTimerId) clearInterval(updateTimerId);
            updateTimerId = setInterval(updateTimer, 500);
            
            setTimeout(() => {
                timerBar.classList.add('active');
            }, 10);

            timerId = setTimeout(() => {
                resetTimer();
                document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Waktu habis!`;
                document.getElementById('kontainer-pertanyaan').style.display = 'none';
                document.getElementById('input-jawaban').value = '';
                document.getElementById('waktu-habis').style.display = 'block';
                pertanyaanSaatIni = null;

                const tombolLemparDadu = document.getElementById('lempar-dadu');
                const tombolGantiPemain = document.getElementById('ganti-pemain');
                tombolLemparDadu.disabled = true;
                tombolLemparDadu.classList.add('tombol-dinonaktifkan');
                tombolGantiPemain.disabled = false;
                tombolGantiPemain.classList.remove('tombol-dinonaktifkan');
            }, 60000);
        }

        function resetTimer() {
            if (timerId) {
                clearTimeout(timerId);
                timerId = null;
            }
            if (updateTimerId) {
                clearInterval(updateTimerId);
                updateTimerId = null;
            }
            const timerBar = document.getElementById('timer-bar');
            const timerBarContainer = document.getElementById('timer-bar-container');
            const dotsContainer = document.getElementById('dots-container');
            timerBar.classList.remove('active');
            timerBar.style.width = '0%';
            dotsContainer.innerHTML = '';
            timerBarContainer.classList.add('hidden');
            document.getElementById('waktu-habis').style.display = 'none';
        }

        function lemparDadu() {
            if (pertanyaanTersedia.length === 0) {
                let pemenang = pemain.reduce((max, p) => p.poinKemenangan > max.poinKemenangan ? p : max, pemain[0]);
                document.getElementById('info').textContent = `Semua pertanyaan telah dijawab! Pemain ${pemenang.id} menang dengan ${pemenang.poinKemenangan} poin!`;
                const tombolLemparDadu = document.getElementById('lempar-dadu');
                const tombolGantiPemain = document.getElementById('ganti-pemain');
                tombolLemparDadu.disabled = true;
                tombolLemparDadu.classList.add('tombol-dinonaktifkan');
                tombolGantiPemain.disabled = true;
                tombolGantiPemain.classList.add('tombol-dinonaktifkan');
                return;
            }

            const dadu = Math.floor(Math.random() * 6) + 1;
            hasilDaduSekarang = null;
            const elemenHasilDadu = document.getElementById('hasil-dadu');
            elemenHasilDadu.classList.add('kedip');
            elemenHasilDadu.textContent = `Dadu: Kocok...`;
            
            const { x, y } = heksagonKePiksel(0, 0);
            animasiKocokanDadu(x, y, dadu, 2000, () => {
                hasilDaduSekarang = dadu;
                elemenHasilDadu.textContent = `Dadu: ${dadu}`;
                setTimeout(() => elemenHasilDadu.classList.remove('kedip'), 2000);

                const pertanyaanArea = pertanyaanTersedia.filter(q => q.area === dadu);
                if (pertanyaanArea.length === 0) {
                    document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Tidak ada pertanyaan tersedia untuk area ${dadu}. Tekan "Ganti Pemain".`;
                    const tombolLemparDadu = document.getElementById('lempar-dadu');
                    const tombolGantiPemain = document.getElementById('ganti-pemain');
                    tombolLemparDadu.disabled = true;
                    tombolLemparDadu.classList.add('tombol-dinonaktifkan');
                    tombolGantiPemain.disabled = false;
                    tombolGantiPemain.classList.remove('tombol-dinonaktifkan');
                    return;
                }
                const indeksPertanyaan = Math.floor(Math.random() * pertanyaanArea.length);
                pertanyaanSaatIni = pertanyaanArea[indeksPertanyaan];

                document.getElementById('kontainer-pertanyaan').style.display = 'block';
                document.getElementById('teks-pertanyaan').textContent = pertanyaanSaatIni.teks;

                const tombolLemparDadu = document.getElementById('lempar-dadu');
                const tombolGantiPemain = document.getElementById('ganti-pemain');
                tombolLemparDadu.disabled = true;
                tombolLemparDadu.classList.add('tombol-dinonaktifkan');
                tombolGantiPemain.disabled = true;
                tombolGantiPemain.classList.add('tombol-dinonaktifkan');

                startTimer();
                tampilkanPapan();
            });
        }

        function kirimJawaban() {
            const jawaban = document.getElementById('input-jawaban').value.trim().toLowerCase();
            const kataKunci = pertanyaanSaatIni.kataKunci;
            const tombolLemparDadu = document.getElementById('lempar-dadu');
            const tombolGantiPemain = document.getElementById('ganti-pemain');

            resetTimer();

            const benar = kataKunci.some(kunci => jawaban.includes(kunci.toLowerCase()));

            if (benar) {
                document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Jawaban Benar!`;
                const indeks = pertanyaanTersedia.findIndex(q => q.id === pertanyaanSaatIni.id);
                pertanyaanTersedia.splice(indeks, 1);

                setTimeout(() => {
                    document.getElementById('kontainer-pertanyaan').style.display = 'none';
                    let areaBelumDiambil = area.filter(t => t.nomor === hasilDaduSekarang && t.pemilik === null && !(t.q === 0 && t.r === 0));
                    if (areaBelumDiambil.length > 0) {
                        menungguPemilihanArea = true;
                        document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Pilih area dengan nomor ${hasilDaduSekarang} untuk mengambil poin`;
                        tampilkanPapan();

                        tombolLemparDadu.disabled = true;
                        tombolLemparDadu.classList.add('tombol-dinonaktifkan');
                        tombolGantiPemain.disabled = true;
                        tombolGantiPemain.classList.add('tombol-dinonaktifkan');
                    } else {
                        document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Tidak dapat rebut area, Selesaikan giliran dengan menekan "Ganti Pemain".`;

                        tombolLemparDadu.disabled = true;
                        tombolLemparDadu.classList.add('tombol-dinonaktifkan');
                        tombolGantiPemain.disabled = false;
                        tombolGantiPemain.classList.remove('tombol-dinonaktifkan');
                    }
                }, 1000);
            } else {
                document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Jawaban Salah.`;
                setTimeout(() => {
                    document.getElementById('kontainer-pertanyaan').style.display = 'none';
                    document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Jawaban Salah. Tekan tombol "Ganti Pemain" untuk melanjutkan.`;

                    tombolLemparDadu.disabled = true;
                    tombolLemparDadu.classList.add('tombol-dinonaktifkan');
                    tombolGantiPemain.disabled = false;
                    tombolGantiPemain.classList.remove('tombol-dinonaktifkan');
                }, 1000);
            }

            document.getElementById('input-jawaban').value = '';
            pertanyaanSaatIni = null;
        }

        function perbaruiPoinKemenangan() {
            pemain.forEach(itemPemain => {
                itemPemain.poinKemenangan = area.filter(t => t.pemilik === pemain.indexOf(itemPemain)).length;
            });
            let teksPoin = '';
            pemain.forEach(itemPemain => {
                teksPoin += `<div class="flex items-center mb-1"><span class="w-4 h-4 mr-2 inline-block" style="background-color: ${itemPemain.warna};"></span>Pemain ${itemPemain.id}: ${itemPemain.poinKemenangan} Poin</div>`;
            });
            document.getElementById('poin-menang').innerHTML = teksPoin;

            let pemenang = pemain.find(p => p.poinKemenangan >= 10);
            if (pemenang) {
                document.getElementById('info').textContent = `Pemain ${pemenang.id} Menang dengan ${pemenang.poinKemenangan} Poin!`;
                const tombolLemparDadu = document.getElementById('lempar-dadu');
                const tombolGantiPemain = document.getElementById('ganti-pemain');
                tombolLemparDadu.disabled = true;
                tombolLemparDadu.classList.add('tombol-dinonaktifkan');
                tombolGantiPemain.disabled = true;
                tombolGantiPemain.classList.add('tombol-dinonaktifkan');
            }
        }

        function giliranBerikutnya() {
            resetTimer();
            pemainSekarang = (pemainSekarang + 1) % pemain.length;
            hasilDaduSekarang = null;
            menungguPemilihanArea = false;
            document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Lempar dadu`;
            document.getElementById('kontainer-pertanyaan').style.display = 'none';
            tampilkanPapan();

            const tombolLemparDadu = document.getElementById('lempar-dadu');
            const tombolGantiPemain = document.getElementById('ganti-pemain');
            tombolLemparDadu.disabled = false;
            tombolLemparDadu.classList.remove('tombol-dinonaktifkan');
            tombolGantiPemain.disabled = true;
            tombolGantiPemain.classList.add('tombol-dinonaktifkan');
        }

        kanvas.addEventListener('click', (event) => {
            if (!menungguPemilihanArea) return;
            const rect = kanvas.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            const areaTerpilih = cariAreaTerdekat(x, y);
            if (areaTerpilih && areaTerpilih.nomor === hasilDaduSekarang && areaTerpilih.pemilik === null && !(areaTerpilih.q === 0 && areaTerpilih.r === 0)) {
                areaTerpilih.pemilik = pemainSekarang;
                tampilkanPapan();
                perbaruiPoinKemenangan();
                menungguPemilihanArea = false;
                document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Ambil sebuah area lalu klik "Ganti Pemain"`;

                const tombolLemparDadu = document.getElementById('lempar-dadu');
                const tombolGantiPemain = document.getElementById('ganti-pemain');
                tombolLemparDadu.disabled = true;
                tombolLemparDadu.classList.add('tombol-dinonaktifkan');
                tombolGantiPemain.disabled = false;
                tombolGantiPemain.classList.remove('tombol-dinonaktifkan');
            }
        });

        document.getElementById('lempar-dadu').addEventListener('click', lemparDadu);
        document.getElementById('ganti-pemain').addEventListener('click', giliranBerikutnya);
        document.getElementById('kirim-jawaban').addEventListener('click', kirimJawaban);
        
        document.getElementById('input-jawaban').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                kirimJawaban();
            }
        });

        function inisialisasiPapan() {
            let nomorTersedia = kocok(nomor.slice());
            tataLetakPapan.forEach((heks) => {
                if (heks.q === 0 && heks.r === 0) {
                    area.push({
                        q: heks.q,
                        r: heks.r,
                        nomor: null,
                        warna: '#000000',
                        pemilik: null
                    });
                } else {
                    let nomorArea = nomorTersedia.shift();
                    let warnaArea = petaWarna[nomorArea];
                    area.push({
                        q: heks.q,
                        r: heks.r,
                        nomor: nomorArea,
                        warna: warnaArea,
                        pemilik: null
                    });
                }
            });
            pertanyaanTersedia = [...pertanyaan];
            document.getElementById('info').textContent = `Pemain ${pemain[pemainSekarang].id}: Lempar dadu`;

            const tombolLemparDadu = document.getElementById('lempar-dadu');
            const tombolGantiPemain = document.getElementById('ganti-pemain');
            tombolLemparDadu.disabled = false;
            tombolLemparDadu.classList.remove('tombol-dinonaktifkan');
            tombolGantiPemain.disabled = true;
            tombolGantiPemain.classList.add('tombol-dinonaktifkan');
        }

        inisialisasiPapan();
        tampilkanPapan();
        perbaruiPoinKemenangan();
    </script>
</body>
</html>